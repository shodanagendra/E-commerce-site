<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>My Orders - SVBN Living</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" />
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top">
  <div class="container-fluid">
    <a class="navbar-brand me-3" href="n1.html">SVBN Living</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSVBN">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarSVBN">
      <a href="n1.html" class="text-white text-decoration-none d-flex align-items-center me-3 mt-3 mt-lg-0">
        <i class="bi bi-house-door-fill me-1"></i> Home
      </a>
      <form class="d-flex me-auto mt-3 mt-lg-0 w-100 w-lg-50">
        <input class="form-control me-2" type="search" placeholder="Search..." aria-label="Search">
        <button class="btn text-white" type="submit" style="border: none; background: none;">
          <i class="bi bi-search"></i>
        </button>
      </form>
      <div class="d-flex align-items-center flex-column flex-lg-row gap-3 mt-3 mt-lg-0">
        <a href="wishlist.html" class="text-white text-decoration-none d-flex align-items-center">
          <i class="bi bi-heart-fill me-1"></i> Wishlist
        </a>
        <a href="cart.html" class="text-white text-decoration-none d-flex align-items-center">
          <i class="bi bi-cart-fill me-1"></i> Cart
        </a>
        <a href="orders.html" class="text-white text-decoration-none d-flex align-items-center">
          <i class="bi bi-box-seam me-1"></i> Orders
        </a>
        <span class="text-white d-flex align-items-center">
          <i class="bi bi-person-circle me-1"></i> User
        </span>
      </div>
    </div>
  </div>
</nav>

<!-- Orders Section -->
<div class="container mt-4">
  <h2 class="mb-4">My Orders</h2>
  <div id="orderlist" class="row"></div>
</div>

<!-- Modal for Invoice -->
<div class="modal fade" id="invoiceModal" tabindex="-1" aria-labelledby="invoiceModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="invoiceModalLabel">Order Invoice</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body" id="invoiceContent">
        <!-- Dynamic Invoice Content -->
      </div>
      <div class="modal-footer">
        <button class="btn btn-primary" onclick="downloadInvoice()">Download Invoice</button>
      </div>
    </div>
  </div>
</div>

<!-- Script Section -->
<script>
  let orders = JSON.parse(localStorage.getItem("orders")) || [];
  const list = document.getElementById("orderlist");

  if (orders.length === 0) {
    list.innerHTML = "<p>No orders found.</p>";
  } else {
    orders.forEach((order, index) => {
      const div = document.createElement("div");
      div.className = "col-md-4 mb-4";
      div.innerHTML = `
        <div class="card h-100" style="cursor:pointer;" onclick="showInvoice(${index})">
          <img src="${order.image}" class="card-img-top" alt="${order.order_name}" style="height: 200px; object-fit: cover;">
          <div class="card-body">
            <h5 class="card-title">${order.order_name}</h5>
            <p class="card-text">Price: ₹${order.order_price}</p>
            <p>Ordered on: ${order.date}</p>
            <p>Delivery by: ${order.delivery}</p>
            <p>Address: ${order.address || 'N/A'}</p>
            <p>Payment Mode: ${order.payment || 'N/A'}</p>
            <button class="btn btn-danger mt-2" onclick="event.stopPropagation(); cancelOrder(${index});">Cancel Order</button>
          </div>
        </div>
      `;
      list.appendChild(div);
    });
  }

  function cancelOrder(index) {
    if (confirm("Are you sure you want to cancel this order?")) {
      orders.splice(index, 1);
      localStorage.setItem("orders", JSON.stringify(orders));
      location.reload();
    }
  }

  let currentInvoice = "";

  function showInvoice(index) {
    const order = orders[index];
    currentInvoice = `
Invoice - SVBN Living
--------------------------
Product       : ${order.order_name}
Price         : ₹${order.order_price}
Ordered On    : ${order.date}
Delivery By   : ${order.delivery}
Address       : ${order.address || 'N/A'}
Payment Mode  : ${order.payment || 'N/A'}
--------------------------
Total         : ₹${order.order_price}
`;

    const invoiceHTML = `
      <div class="row">
        <div class="col-md-4">
          <img src="${order.image}" alt="${order.order_name}" class="img-fluid rounded border">
        </div>
        <div class="col-md-8">
          <h4>${order.order_name}</h4>
          <p><strong>Price:</strong> ₹${order.order_price}</p>
          <p><strong>Ordered On:</strong> ${order.date}</p>
          <p><strong>Delivery By:</strong> ${order.delivery}</p>
          <p><strong>Address:</strong> ${order.address || 'N/A'}</p>
          <p><strong>Payment Mode:</strong> ${order.payment || 'N/A'}</p>
          <hr/>
          <h5>Total: ₹${order.order_price}</h5>
        </div>
      </div>
    `;
    document.getElementById("invoiceContent").innerHTML = invoiceHTML;
    const modal = new bootstrap.Modal(document.getElementById('invoiceModal'));
    modal.show();
  }

  function downloadInvoice() {
    const blob = new Blob([currentInvoice], { type: "text/plain" });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "invoice.txt";
    link.click();
  }
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- Footer -->
<footer class="bg-dark text-white text-center py-3 mt-4">
  <div class="container">
    <p class="mb-0">© 2025 SVBN Living | Designed with ♥ for your beautiful home</p>
  </div>
</footer>

</body>
</html>
